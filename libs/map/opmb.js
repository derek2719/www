(function(){var t,o,y,D,v,g,w;var m=false;var n=false;var O=false;var S=false;var A=500;var L=false;var i=Openlayers.Map;var f=Openlayers.At;var I=f.CP;var d=f.AK;var e=f.Ds;var k=f.Fo;var x=f.Ex;var s=f.GM;var G=f.CG;var b=f.CT;var h=Openlayers.Pixel;var P=f.Am;var E=(navigator.userAgent.indexOf("iPhone OS 5_")>-1)?true:false;var U=0;var r=0;var l=[];var J=[];var q=0;var p=0;var N=1;var Q=[{x:0,y:0},{x:0,y:0}];var u=false;var R=false;var m=false;var c=false;var F=function(W){if(W){t.Kv.style.WebkitTransform=""}q=0;p=0;N=1;Q[0].x=Q[0].y=Q[1].x=Q[1].y=0;R=false};function C(Z){var aa=[];for(var Y,X=0,W=Z.touches.length;X<W;X++){Y=Z.touches[X];aa.push({x:Y.pageX,y:Y.pageY})}return aa}function j(W,Y,X){t.Kv.style.WebkitTransform=(y.BN?"translate("+W+"px, "+Y+"px) ":"")+(y.BP?"scale("+X+") ":"")}function K(){var aa=t.GI;var W=0;var ab=0;while(aa!=document.body){W+=aa.offsetLeft;ab+=aa.offsetTop;aa=aa.offsetParent}if(E){W=0;ab=0}if(y.BN){var Y=(Q[0].x+Q[1].x)/2-t.GU-W;var X=(Q[0].y+Q[1].y)/2-t.Fj-ab;t.Kv.style.WebkitTransformOrigin=W+"px "+ab+"px"}else{var Z=t.Ks;t.Kv.style.WebkitTransformOrigin=Math.round(Z.width/2)+"px "+Math.round(Z.height/2)+"px"}}function T(X,W){if(X&&W){return Math.round(Math.sqrt(Math.pow(X.x-W.x,2)+Math.pow(X.y-W.y,2)))}}function z(X){S=true;var W=new k("rightdblclickend",X);setTimeout(function(){H();t.Dw(W)},A)}function H(W){if(S){S=false}}function a(X){O=true;g=new k("touch").EH(X);w=new h(X.changedTouches[0].clientX,X.changedTouches[0].clientY);var W=new k("dblclickend",X);setTimeout(function(){V();t.Dw(W)},A);t.Dw(G.GE(t,o,X,"click",false))}function V(){if(O){O=false;w=null;if(!L){t.Dw(g)}}}var B={ER:function(W){t=W;o=W.FR();D=W.Kq;v=W.Cz;y=W.FW;e.Fm(o,"touchstart",function(X){if(D.GH==v._NO_OPERATE||D.GH==v._MAP_OPERATE){D.GH=v._MAP_OPERATE;n=false;t.Dw(G.GE(t,o,X,"touchstart",false).EH(X));if(X.touches.length==2){if(S){var ag=X.touches[0].clientX;var aa=X.touches[0].clientY;var af=X.touches[1].clientX;var Z=X.touches[1].clientY;var ai=Math.round(ag-((ag-af)/2));var ah=Math.round(aa-((aa-Z)/2));if(o.getBoundingClientRect){var ac=o.getBoundingClientRect();var ae=o.ownerDocument||o.document;var ad=ac.left+Math.max(ae.documentElement.scrollLeft,ae.body.scrollLeft)-ae.documentElement.clientLeft;var ab=ac.top+Math.max(ae.documentElement.scrollTop,ae.body.scrollTop)-ae.documentElement.clientTop;ai=Math.abs(ai-ad);ah=Math.abs(ah-ab)}var Y=new k("rightdblclick");Y.pixel=new h(ai,ah);t.Dw(Y);H()}else{z(X)}}}});e.Fm(o,"touchmove",function(X){if(D.GH==v._MAP_OPERATE){x.AZ(X);n=true;t.Dw(G.GE(t,o,X,"touchmove",false).EH(X))}});e.Fm(o,"touchend",function(Z){if(D.GH==v._MAP_OPERATE){x.AZ(Z);if(!n){if(O){L=true;t.Dw(G.GE(t,o,Z,"click",false));var X=new h(Z.changedTouches[0].clientX,Z.changedTouches[0].clientY);var Y=T(w,X);if(Y<20){t.Dw(G.GE(t,o,Z,"dblclick",false));t.Dw(new k("dbltouch").EH(Z))}else{t.Dw(G.GE(t,o,Z,"touchend",false).EH(Z))}V();L=false}else{a(Z)}}if(Z.targetTouches.length<=0){D.GH=v._NO_OPERATE}t.Dw(new k("touchend").EH(Z))}});e.Fm(o,"gesturestart",function(X){if(D.GH==v._MAP_OPERATE){X.preventDefault();t.Dw(new k("gesturestart").EH(X))}});e.Fm(o,"gesturechange",function(X){if(D.GH==v._MAP_OPERATE){X.preventDefault();t.Dw(new k("gesturechange").EH(X))}});e.Fm(o,"gestureend",function(X){if(D.GH==v._MAP_OPERATE){X.preventDefault();t.Dw(new k("gestureend").EH(X))}});W.addEventListener("touchstart",function(Y){l=C(Y);var X=Y.targetTouches.length;U+=X;if(U>2){U=2}if(X==2){D.Fr=true}if(D.GR){D.GR.Ej()}if(U==1){D.Aj=q;D.BR=p;Q[0].x=Y.targetTouches[0].clientX;Q[0].y=Y.targetTouches[0].clientY}else{if(U==2){Q[1].x=Y.targetTouches[X-1].clientX;Q[1].y=Y.targetTouches[X-1].clientY}}},true);W.addEventListener("touchmove",function(ai){if(4<=b.LR){J=C(ai);var aj=1;if(2==l.length&&2==J.length){aj=T(J[0],J[1])/T(l[0],l[1])}if(0<Math.abs(1-aj)){N=aj;u=true;K()}}var af=ai.targetTouches.length;if(U==1&&r!=2){q+=ai.targetTouches[0].clientX-Q[0].x;p+=ai.targetTouches[0].clientY-Q[0].y;Q[0].x=ai.targetTouches[0].clientX;Q[0].y=ai.targetTouches[0].clientY;j(q,p,N);R=true}if(U==2){var ah=Q[0].x;var ae=Q[0].y;var ag=Q[1].x;var ad=Q[1].y;if(R){var X=null;for(var ac=0;ac<af;ac++){X=new h(ai.targetTouches[ac].clientX,ai.targetTouches[ac].clientY);if(T(X,new h(Q[0].x,Q[0].y))<T(X,new h(Q[1].x,Q[1].y))){Q[0].x=X.x;Q[0].y=X.y}else{Q[1].x=X.x;Q[1].y=X.y}}q+=(Q[0].x-ah+Q[1].x-ag)/2;p+=(Q[0].y-ae+Q[1].y-ad)/2;j(q,p,N)}else{var X=new h(ai.targetTouches[0].clientX,ai.targetTouches[0].clientY);var ab=new h(Q[0].x-Q[0].y);if(af==1){if(T(ab,X)<30){Q[0].x=ai.targetTouches[0].clientX;Q[0].y=ai.targetTouches[0].clientY}else{R=true;Q[1].x=ai.targetTouches[0].clientX;Q[1].y=ai.targetTouches[0].clientY}}if(af==2){var Z=new h(ai.targetTouches[1].clientX,ai.targetTouches[1].clientY);if(T(X,Z)<30){Q[0].x=ai.targetTouches[1].clientX;Q[0].y=ai.targetTouches[1].clientY}else{if(T(ab,X)<T(ab,Z)){Q[0].x=ai.targetTouches[0].clientX;Q[0].y=ai.targetTouches[0].clientY;Q[1].x=ai.targetTouches[1].clientX;Q[1].y=ai.targetTouches[1].clientY}else{Q[1].x=ai.targetTouches[0].clientX;Q[1].y=ai.targetTouches[0].clientY;Q[0].x=ai.targetTouches[1].clientX;Q[0].y=ai.targetTouches[1].clientY}R=true}}}}if(U==1&&r==2){var X=null;for(var ac=0;ac<af;ac++){X=new h(ai.targetTouches[ac].clientX,ai.targetTouches[ac].clientY);if(T(X,new h(Q[0].x,Q[0].y))<T(X,new h(Q[1].x,Q[1].y))){q+=X.x-Q[0].x;p+=X.y-Q[0].y;Q[0].x=X.x;Q[0].y=X.y}else{q+=X.x-Q[1].x;p+=X.y-Q[1].y;Q[1].x=X.x;Q[1].y=X.y}}j(q,p,N)}if(U==1&&y.BN){if(!m){m=true;t.Dw(G.GE(t,o,ai,"dragstart",false));t.Dw(new k("movestart"));var aa=ai.changedTouches[0].clientX;var Y=ai.changedTouches[0].clientY;D.BV=new h(aa,Y);D.AO=P.Cl();c=true}D.Ct=P.Cl();t.Dw(G.GE(t,o,ai,"dragging",false))}},true);W.addEventListener("touchend",function(Y){r=U;if(D.Fr){U=Y.targetTouches.length;delete D.Fr}else{U--}if(U==-1){U=0}if(b.EC){U=0}if(U==0){if(u){var ac=0;var ae=t.getZoomLevel();if(y.BP){ac=Math.round(Math.log(N)/Math.log(2));ae=Math.max(Math.min(t.getZoomLevel()+ac,y.HF),y.Ev)}var ad=t.lonLatToPixel(t.getCenter());var Z=new h((ad.x-q/Math.pow(2,ac)),(ad.y-p/Math.pow(2,ac)));var X=y.BN?t.pixelToLonLat(Z):t.getCenter();t.centerAndZoomLevel(X,ae)}if(q!=D.Aj||p!=D.BR){if(c&&!u){var ab=Y.changedTouches[0].clientX;var aa=Y.changedTouches[0].clientY;t.Dw(G.GE(t,o,Y,"dragend",true));t.Df(new h(ab,aa),{x:q,y:p});c=false}if(u){F(true)}else{F(false)}}m=false;u=false;r=0}},true);W.addEventListener("gesturechange",function(X){N=X.scale;u=true;K()})}};d.GZ(I,B);var M={Df:function(af,aa){var ap=this,ab=ap.Kv.style;if(!ap.FW.Em){setTimeout(function(){ab.WebkitTransform=""},0);setTimeout(function(){ap.EJ(ap.GU+aa.x,ap.Fj+aa.y)},0);ap.Dw(new k("moveend"));return}var ac=ap.Kq;var aj=P.Cl();if(aj-ac.Ct>140){setTimeout(function(){ab.WebkitTransform=""},0);setTimeout(function(){ap.EJ(ap.GU+aa.x,ap.Fj+aa.y)},0);ap.Dw(new Event("moveend"));m=false;return}else{var ad=ac.BV,ak=af,Z=T(ad,ak),ag=[ak.x-ad.x>0?1:-1,ak.y-ad.y>0?1:-1],X=(aj-ac.AO)/1000,aq=Z/X/2,ao=0.5,ae=aq/(2*ao),ah=0.5*ae*aq/1000,ar=Math.abs(ad.x-ak.x),at=Math.abs(ad.y-ak.y),al=0,an=0;if(at==0){al=ar}else{var W=Math.abs(ad.x-ak.x)/Math.abs(ad.y-ak.y);an=Math.round(Math.sqrt(ah*ah/(1+W*W)));al=Math.round(W*an)}if(ag[0]==-1){al=-al}if(ag[1]==-1){an=-an}if(ac.GR){ac.GR.Ej()}var Y=aq/1000,ai=ap.GU,am=ap.Fj;ac.GR=new s({Fb:ae,AA:25,DH:function(au){var au=au*Y/(2*ao);return Y*au-ao*au*au},DM:function(au){au=au*(4*ao)/(Y*Y);ab.WebkitTransform="translate("+(aa.x+Math.round(au*al))+"px ,"+(aa.y+Math.round(au*an))+"px)"},AD:function(){ac.GR=null;setTimeout(function(){ab.WebkitTransform=""},0);setTimeout(function(){ap.EJ(ai+aa.x+Math.round(al),am+aa.y+Math.round(an))},0);ap.Dw(new k("moveend"))},AW:function(au){ac.GR=null;au=au*(4*ao)/(Y*Y);setTimeout(function(){ab.WebkitTransform=""},0);setTimeout(function(){ap.EJ(ai+aa.x+Math.round(au*al),am+aa.y+Math.round(au*an))},0);ap.Dw(new k("moveend"))}})}}};d.GZ(i,M)}());